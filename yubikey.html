<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>WebAuthn Example</title>
</head>

<body>
	<h1>WebAuthn Example</h1>
	<button id="registerButton">Register YubiKey</button>
	<button id="loginButton">Login with YubiKey</button>

	<script>
		const BASEURL = "http://localhost:3000";

		

		document.addEventListener('DOMContentLoaded', () => {
			const registerButton = document.getElementById('registerButton');
			const loginButton = document.getElementById('loginButton');

			let publicKey;

			// Function to register a YubiKey
			async function registerYubiKey() {
				try {
					// Request a challenge from the server
					const response = await fetch(BASEURL +'/register', { method: 'POST' });
					const challenge = await response.json();

					// Create a new credential for the YubiKey
					publicKey = await navigator.credentials.create({
						publicKey: {
							challenge: Uint8Array.from(challenge),
							rp: { name: 'Your Web Service' },
							user: { id: Uint8Array.from([1]), name: 'user@example.com', displayName: 'User' },
							pubKeyCredParams: [{ type: 'public-key', alg: -7 }], // YubiKey's preferred algorithm
							authenticatorSelection: { authenticatorAttachment: 'cross-platform' },
							attestation: 'direct'
						}
					});

					console.log('YubiKey registered successfully:', publicKey);

				} catch (error) {
					console.error('Error registering YubiKey:', error);
				}
			}

			// Function to login with the YubiKey
			async function loginWithYubiKey() {
				try {
					// Request a challenge from the server
					const response = await fetch(BASEURL + '/verify', { method: 'POST' });
					const challenge = await response.json();

					// Create an assertion for the YubiKey
					const assertion = await navigator.credentials.get({
						publicKey: {
							challenge: Uint8Array.from(challenge),
							rpId: 'YourWebDomain.com', // Update with your web domain
							allowCredentials: [{ type: 'public-key', id: publicKey.rawId }],
						}
					});

					console.log('YubiKey authentication successful:', assertion);

				} catch (error) {
					console.error('Error logging in with YubiKey:', error);
				}
			}

			registerButton.addEventListener('click', registerYubiKey);
			loginButton.addEventListener('click', loginWithYubiKey);
		});
	</script>
</body>

</html>